@page "/transacoes"
@using Finance.Contracts.Requests.Transactions
@using Finance.Domain.Common
@using Finance.Domain.Enums
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@inherits Finance.Web.Pages.Transactions.GetAll

<MudText Typo="Typo.h4">Transações</MudText>

<div class="d-flex flex-wrap flex-grow-1 gap-4">
    <MudDatePicker Label="Data Início" @bind-Date="StartDate" />
    <MudDatePicker Label="Data Fim" @bind-Date="EndDate" />
    <MudButton Variant="Variant.Filled"
               OnClick="GetTransactionsAsync"
               StartIcon="@Icons.Material.Filled.Search">
        Buscar
    </MudButton>
</div>

<div class="d-flex justify-end mt-4 mb-4">
    <MudButton Href="/transacoes/criar"
               Variant="Variant.Filled"
               Color="Color.Primary"
               StartIcon="@Icons.Material.Filled.Add">
        Nova Transação
    </MudButton>
</div>

@if (IsBusy)
{
    <div class="d-flex justify-center my-4">
        <MudProgressCircular Indeterminate="true" />
    </div>
}
else
{
    <MudTable Items="@Transactions" Hover="true" Striped="true" Bordered="true">
        <HeaderContent>
            <MudTh>Id</MudTh>
            <MudTh>Título</MudTh>
            <MudTh>Valor</MudTh>
            <MudTh>Data</MudTh>
            <MudTh></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Id">@context.Id</MudTd>
            <MudTd DataLabel="Título">@context.Title</MudTd>
            <MudTd DataLabel="Valor">
                <MudText Color="@(context.Type == ETransactionType.Deposit ? Color.Success : Color.Error)">
                    @Math.Abs(context.Amount).ToString("C")
                </MudText>
            </MudTd>
            <MudTd DataLabel="Data">@context.PaidOrReceivedAt?.ToString("dd/MM/yyyy")</MudTd>
            <MudTd>
                <MudButton Variant="Variant.Outlined"
                           Color="Color.Primary"
                           Size="Size.Small"
                           Href="@($"/transacoes/editar/{context.Id}")">
                    Editar
                </MudButton>
                <MudButton Variant="Variant.Outlined" 
                           Color="Color.Error" 
                           Size="Size.Small" 
                           OnClick="@(() => OnDeleteButtonClickedAsync(context.Id, context.Title))">
                    Excluir
                </MudButton>
            </MudTd>
        </RowTemplate>
    </MudTable>
}